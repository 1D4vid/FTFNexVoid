--[[ 
    NEXVOID HUB - Ultimate Fix
    - Floating Button Positioned Below Game Menu
    - Gray Characters Logic Fixed (Restores Clothes & Colors properly)
]]

-- SERVICES
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Lighting = game:GetService("Lighting")
local Workspace = game:GetService("Workspace")
local MaterialService = game:GetService("MaterialService")
local LocalPlayer = Players.LocalPlayer

if not LocalPlayer then
	repeat task.wait() until Players.LocalPlayer
	LocalPlayer = Players.LocalPlayer
end

-- ===========================
-- CONFIGURA√á√ïES GERAIS
-- ===========================
local isMobile = UserInputService.TouchEnabled
local CurrentKey = Enum.KeyCode.K
local ExecutorName = identifyexecutor and identifyexecutor() or "Unknown"

-- VARIAVEIS DE CONTROLE
local LegitSettings = {
	MuteSteps = false,
	MuteJumps = false,
	MuteHack = false
}

-- ESP COLORS (GLOBAL)
local ESP_COLORS = {
	Beast = Color3.fromRGB(255, 0, 0),
	Survivor = Color3.fromRGB(0, 255, 0),
	Border = Color3.fromRGB(255, 255, 255),
	Blue = Color3.fromRGB(0, 170, 255),
	Green = Color3.fromRGB(0, 255, 0),
	Red = Color3.fromRGB(255, 0, 0),
	Exit = Color3.fromRGB(255, 170, 0),
	Door = Color3.fromRGB(255, 255, 0),
	Pod = Color3.fromRGB(0, 255, 255)
}

local Config = {
	MainSize = isMobile and UDim2.new(0, 500, 0, 320) or UDim2.new(0, 600, 0, 400),
	SidebarWidth = isMobile and 130 or 150,
	FooterHeight = 18, 
	BtnHeight = isMobile and 29 or 36, 
	ListPadding = UDim.new(0, 2), 
	FontSize = isMobile and 11 or 13,
	IconSize = isMobile and 14 or 18
}

local ContentConfig = {
	ItemHeight = 40,
	PlayerCardHeight = 50,
	ItemPadding = UDim.new(0, 6)
}

-- REMOVE OLD UI
pcall(function()
	if LocalPlayer.PlayerGui:FindFirstChild("NexVoidHub") then
		LocalPlayer.PlayerGui.NexVoidHub:Destroy()
	end
end)

-- ===========================
-- THEME (RED & BLACK - GLASS STYLE)
-- ===========================
local Theme = {
	FrameColor = Color3.fromRGB(10, 10, 10), 
	ContentColor = Color3.fromRGB(18, 18, 18), 
	ItemColor = Color3.fromRGB(0, 0, 0), 
	ItemStroke = Color3.fromRGB(50, 0, 0), 
	SwitchOff = Color3.fromRGB(30, 30, 30), 
	Accent = Color3.fromRGB(220, 0, 0), 
	Text = Color3.fromRGB(255, 255, 255), 
	TextDark = Color3.fromRGB(180, 180, 180),
	Font = Enum.Font.GothamBold,
	CloseRed = Color3.fromRGB(255, 0, 0) 
}

-- GUI SETUP
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NexVoidHub"
ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
ScreenGui.IgnoreGuiInset = true

-- ===========================
-- FUN√á√ÉO DE ARRASTAR
-- ===========================
local function MakeDraggable(triggerObject, frameObject)
	local dragging = false
	local dragInput, dragStart, startPos

	triggerObject.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = input.Position
			startPos = frameObject.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)

	triggerObject.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			dragInput = input
		end
	end)

	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			frameObject.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
end

-- ==========================================================
-- üîä SISTEMA DE SOM INTELIGENTE
-- ==========================================================
local ActiveSounds = {
	Running = {ID = nil, Vol = 1.0},
	Jumping = {ID = nil, Vol = 0.5},
	Landing = {ID = nil, Vol = 0.5}
}
local SoundConnections = {}
local OriginalSoundIDs = {}

local function IsLocalSound(soundObj)
	if not LocalPlayer.Character then return false end
	local root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
	if root and soundObj.Parent == root then
		return true
	end
	return false
end

local function EnforceSound(soundObj, nameType)
	if SoundConnections[soundObj] then
		for _, c in pairs(SoundConnections[soundObj]) do c:Disconnect() end
		SoundConnections[soundObj] = nil
	end

	if not OriginalSoundIDs[soundObj] then
		OriginalSoundIDs[soundObj] = soundObj.SoundId
	end

	local settings = ActiveSounds[nameType]
	local targetID = settings.ID
	local targetVol = settings.Vol

	if targetID == nil then
		if OriginalSoundIDs[soundObj] then
			soundObj.SoundId = OriginalSoundIDs[soundObj]
		end
		if nameType == "Running" then targetVol = 1.0 else targetVol = 0.5 end
	else
		soundObj.SoundId = "rbxassetid://" .. targetID
	end

	if IsLocalSound(soundObj) then
		if nameType == "Running" and LegitSettings.MuteSteps then
			targetVol = 0
		elseif (nameType == "Jumping" or nameType == "Landing") and LegitSettings.MuteJumps then
			targetVol = 0
		end
	end

	soundObj.Volume = targetVol
	
	local con1 = soundObj:GetPropertyChangedSignal("SoundId"):Connect(function()
		if targetID and soundObj.SoundId ~= "rbxassetid://" .. targetID then 
			soundObj.SoundId = "rbxassetid://" .. targetID 
		end
	end)
	
	local con2 = soundObj:GetPropertyChangedSignal("Volume"):Connect(function()
		local currentTarget = targetVol
		if IsLocalSound(soundObj) then
			if nameType == "Running" and LegitSettings.MuteSteps then
				currentTarget = 0
			elseif (nameType == "Jumping" or nameType == "Landing") and LegitSettings.MuteJumps then
				currentTarget = 0
			end
		end
		if soundObj.Volume ~= currentTarget then 
			soundObj.Volume = currentTarget 
		end
	end)
	
	SoundConnections[soundObj] = {con1, con2}
end

local function ProcessCharacter(char)
	local root = char:WaitForChild("HumanoidRootPart", 10)
	if not root then return end
	local soundNames = {"Running", "Jumping", "Landing"}
	
	for _, name in ipairs(soundNames) do
		task.spawn(function()
			local sound = root:WaitForChild(name, 5)
			if sound and sound:IsA("Sound") then EnforceSound(sound, name) end
		end)
	end
	
	root.ChildAdded:Connect(function(child)
		if child:IsA("Sound") and (child.Name == "Running" or child.Name == "Jumping" or child.Name == "Landing") then
			task.wait()
			EnforceSound(child, child.Name)
		end
	end)
end

local function ApplyGlobalChanges()
	for _, p in pairs(Players:GetPlayers()) do if p.Character then ProcessCharacter(p.Character) end end
	for _, child in ipairs(Workspace:GetChildren()) do if child:FindFirstChild("Humanoid") then ProcessCharacter(child) end end
end

Players.PlayerAdded:Connect(function(p)
	p.CharacterAdded:Connect(ProcessCharacter)
	if p.Character then ProcessCharacter(p.Character) end
end)
for _, p in pairs(Players:GetPlayers()) do
	if p.Character then ProcessCharacter(p.Character) end
	p.CharacterAdded:Connect(ProcessCharacter)
end
Workspace.ChildAdded:Connect(function(child)
	if child:FindFirstChild("Humanoid") then ProcessCharacter(child) end
end)

local function SetSound(Type, ID, Vol)
	if ID == "Default" then
		ActiveSounds[Type].ID = nil
	else 
		ActiveSounds[Type].ID = ID
		ActiveSounds[Type].Vol = Vol 
	end
	ApplyGlobalChanges()
end

-- ===========================
-- GLOBAL CURSOR ELEMENTS
-- ===========================
local CurrentCursorSize = 24
local PCCursorActive = false
local MobileCrosshair = Instance.new("ImageLabel"); MobileCrosshair.Name = "MobileCrosshair"; MobileCrosshair.Size = UDim2.new(0, CurrentCursorSize, 0, CurrentCursorSize); MobileCrosshair.AnchorPoint = Vector2.new(0.5, 0.5); MobileCrosshair.Position = UDim2.new(0.5, 0, 0.5, 0); MobileCrosshair.BackgroundTransparency = 1; MobileCrosshair.Image = ""; MobileCrosshair.Visible = false; MobileCrosshair.ZIndex = 99; MobileCrosshair.Parent = ScreenGui 
local PCSoftwareCursor = Instance.new("ImageLabel"); PCSoftwareCursor.Name = "PCCursor"; PCSoftwareCursor.Size = UDim2.new(0, CurrentCursorSize, 0, CurrentCursorSize); PCSoftwareCursor.AnchorPoint = Vector2.new(0.5, 0.5); PCSoftwareCursor.BackgroundTransparency = 1; PCSoftwareCursor.Image = ""; PCSoftwareCursor.Visible = false; PCSoftwareCursor.ZIndex = 10000; PCSoftwareCursor.Parent = ScreenGui

local function UpdateCursorSizes(val) CurrentCursorSize = val; MobileCrosshair.Size = UDim2.new(0, val, 0, val); PCSoftwareCursor.Size = UDim2.new(0, val, 0, val) end
RunService.RenderStepped:Connect(function() if PCCursorActive then UserInputService.MouseIconEnabled = false; local mousePos = UserInputService:GetMouseLocation(); PCSoftwareCursor.Position = UDim2.new(0, mousePos.X, 0, mousePos.Y) else if UserInputService.MouseIconEnabled == false and not PCCursorActive then UserInputService.MouseIconEnabled = true end end end)

-- MAIN FRAME
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Size = Config.MainSize
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Position = UDim2.new(0.5, 0, 0.6, 0)
MainFrame.BackgroundColor3 = Theme.FrameColor -- Fallback color
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = false
MainFrame.ClipsDescendants = true
MainFrame.Visible = true 
MainFrame.Parent = ScreenGui

-- ===========================
-- ANIME BACKGROUND
-- ===========================
local AnimeBg = Instance.new("ImageLabel")
AnimeBg.Name = "AnimeBackground"
AnimeBg.Size = UDim2.new(1, 0, 1, 0)
AnimeBg.Image = "rbxassetid://132502592739305"
AnimeBg.ScaleType = Enum.ScaleType.Crop
AnimeBg.BackgroundTransparency = 1
AnimeBg.ZIndex = 1
AnimeBg.Parent = MainFrame

-- DARK OVERLAY
local DarkOverlay = Instance.new("Frame")
DarkOverlay.Name = "DarkOverlay"
DarkOverlay.Size = UDim2.new(1, 0, 1, 0)
DarkOverlay.BackgroundColor3 = Color3.new(0,0,0)
DarkOverlay.BackgroundTransparency = 0.65 
DarkOverlay.ZIndex = 2
DarkOverlay.Parent = MainFrame

-- NOTIFICATION
local function SendNotification(text, duration)
	local NotifyFrame = Instance.new("Frame")
	NotifyFrame.Size = UDim2.new(0, 320, 0, 34)
	NotifyFrame.AnchorPoint = Vector2.new(0.5, 0)
	NotifyFrame.Position = UDim2.new(0.5, 0, 0, -50)
	NotifyFrame.BackgroundColor3 = Theme.FrameColor
	NotifyFrame.BorderSizePixel = 0
	NotifyFrame.ZIndex = 200
	NotifyFrame.Parent = ScreenGui
	local NC = Instance.new("UICorner"); NC.CornerRadius = UDim.new(0, 8); NC.Parent = NotifyFrame
	local NS = Instance.new("UIStroke"); NS.Color = Theme.Accent; NS.Thickness = 1.2; NS.Parent = NotifyFrame
	local NLabel = Instance.new("TextLabel"); NLabel.Size = UDim2.new(1, 0, 1, 0); NLabel.BackgroundTransparency = 1; NLabel.Text = text; NLabel.TextColor3 = Theme.Text; NLabel.Font = Enum.Font.Gotham; NLabel.TextSize = 12; NLabel.TextWrapped = true; NLabel.Parent = NotifyFrame
	TweenService:Create(NotifyFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.Out), {Position = UDim2.new(0.5, 0, 0, 20)}):Play()
	task.spawn(function() task.wait(duration or 4); local Out = TweenService:Create(NotifyFrame, TweenInfo.new(0.5, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Position = UDim2.new(0.5, 0, 0, -50)}); Out:Play(); Out.Completed:Wait(); NotifyFrame:Destroy() end)
end

-- ===========================
-- UI CONSTRUCTION
-- ===========================
-- TOP BAR (Transparent to show image)
local TopBar = Instance.new("Frame"); TopBar.Size = UDim2.new(1, 0, 0, 40); TopBar.BackgroundColor3 = Color3.new(0,0,0); TopBar.BackgroundTransparency = 0.5; TopBar.BorderSizePixel = 0; TopBar.ZIndex = 3; TopBar.Parent = MainFrame
MakeDraggable(TopBar, MainFrame)

local TitleLabel = Instance.new("TextLabel"); TitleLabel.Name = "TitleLabel"; TitleLabel.Text = "Nex<font color='rgb(220,0,0)'>Void</font>"; TitleLabel.RichText = true; TitleLabel.Size = UDim2.new(0, 200, 1, 0); TitleLabel.BackgroundTransparency = 1; TitleLabel.Font = Theme.Font; TitleLabel.TextSize = 18; TitleLabel.TextColor3 = Theme.Text; TitleLabel.TextXAlignment = Enum.TextXAlignment.Left; TitleLabel.Position = UDim2.new(0, 45, 0, 0); TitleLabel.ZIndex = 4; TitleLabel.Parent = TopBar
local LogoIcon = Instance.new("ImageLabel"); LogoIcon.Image = "rbxassetid://124956767763560"; LogoIcon.Size = UDim2.new(0, 20, 0, 20); LogoIcon.Position = UDim2.new(0, 15, 0.5, -10); LogoIcon.BackgroundTransparency = 1; LogoIcon.ScaleType = Enum.ScaleType.Fit; LogoIcon.ImageColor3 = Theme.Accent; LogoIcon.ZIndex = 4; LogoIcon.Parent = TopBar

-- MINIMIZED BUTTON (FIXED POSITION BELOW GAME MENU)
local OpenButton = Instance.new("ImageButton"); 
OpenButton.Name = "OpenButton"; 
OpenButton.Size = UDim2.new(0, 35, 0, 35); 
-- POSI√á√ÉO ATUALIZADA: Canto direito (1), Altura 0.65 (Abaixo do menu padr√£o que fica ~0.5)
OpenButton.AnchorPoint = Vector2.new(1, 0.5)
OpenButton.Position = UDim2.new(1, -45, 0.65, 0); 
OpenButton.BackgroundColor3 = Theme.FrameColor; 
OpenButton.Image = "rbxassetid://73244880397617";
OpenButton.Visible = false; 
OpenButton.Active = true; 
OpenButton.Draggable = false; -- N√£o arrast√°vel
OpenButton.Parent = ScreenGui; 
Instance.new("UICorner", OpenButton).CornerRadius = UDim.new(0, 4); 
local OBS = Instance.new("UIStroke"); OBS.Color = Theme.Accent; OBS.Thickness = 1.5; OBS.Parent = OpenButton

local function createTopBtn(name, icon, offsetOrder, isImage)
	local Btn
	if isImage then
		Btn = Instance.new("ImageButton"); Btn.Image = "rbxassetid://" .. icon; Btn.ScaleType = Enum.ScaleType.Fit; local iconSize = (name == "Search") and 22 or 16; Btn.ImageTransparency = 1; local Inner = Instance.new("ImageLabel"); Inner.Size = UDim2.new(0, iconSize, 0, iconSize); Inner.Position = UDim2.new(0.5, -(iconSize/2), 0.5, -(iconSize/2)); Inner.BackgroundTransparency = 1; Inner.Image = "rbxassetid://" .. icon; Inner.ImageColor3 = Theme.TextDark; Inner.ScaleType = Enum.ScaleType.Fit; Inner.ZIndex = 4; Inner.Parent = Btn; Btn.MouseEnter:Connect(function() Inner.ImageColor3 = Theme.Accent end); Btn.MouseLeave:Connect(function() Inner.ImageColor3 = Theme.TextDark end)
	else
		Btn = Instance.new("TextButton"); Btn.Text = icon; Btn.Font = Enum.Font.GothamBlack; Btn.TextSize = 16; Btn.TextColor3 = Theme.TextDark; if icon == "-" then Btn.Text = ""; local Line = Instance.new("Frame"); Line.Size = UDim2.new(0, 12, 0, 2); Line.Position = UDim2.new(0.5, -6, 0.5, 0); Line.BackgroundColor3 = Theme.TextDark; Line.BorderSizePixel = 0; Line.ZIndex = 4; Line.Parent = Btn; Btn.MouseEnter:Connect(function() Line.BackgroundColor3 = Theme.Accent end); Btn.MouseLeave:Connect(function() Line.BackgroundColor3 = Theme.TextDark end) else Btn.MouseEnter:Connect(function() Btn.TextColor3 = Theme.CloseRed end); Btn.MouseLeave:Connect(function() Btn.TextColor3 = Theme.TextDark end) end
	end
	Btn.Name = name; Btn.Parent = TopBar; Btn.BackgroundTransparency = 1; Btn.ZIndex = 4; Btn.Position = UDim2.new(1, -(40 * offsetOrder), 0, 0); Btn.Size = UDim2.new(0, 40, 1, 0); return Btn
end
local CloseBtn = createTopBtn("Close", "X", 1, false); local MinimizeBtn = createTopBtn("Minimize", "-", 2, false); local SettingsBtn = createTopBtn("Settings", "11293977610", 3, true); local SearchBtn = createTopBtn("Search", "104986431790017", 4, true)

local SearchContainer = Instance.new("Frame"); SearchContainer.Name = "SearchContainer"; SearchContainer.Size = UDim2.new(0, 0, 0, 26); SearchContainer.Position = UDim2.new(1, -165, 0.5, -13); SearchContainer.AnchorPoint = Vector2.new(1, 0); SearchContainer.BackgroundColor3 = Theme.ContentColor; SearchContainer.BorderSizePixel = 0; SearchContainer.ClipsDescendants = true; SearchContainer.ZIndex = 4; SearchContainer.Parent = TopBar; Instance.new("UICorner", SearchContainer).CornerRadius = UDim.new(0, 4)
local SearchBox = Instance.new("TextBox"); SearchBox.Size = UDim2.new(1, -10, 1, 0); SearchBox.Position = UDim2.new(0, 10, 0, 0); SearchBox.BackgroundTransparency = 1; SearchBox.Text = ""; SearchBox.PlaceholderText = "Search..."; SearchBox.TextColor3 = Theme.Text; SearchBox.PlaceholderColor3 = Theme.TextDark; SearchBox.Font = Theme.Font; SearchBox.TextSize = 12; SearchBox.TextXAlignment = Enum.TextXAlignment.Left; SearchBox.ClearTextOnFocus = false; SearchBox.ZIndex = 5; SearchBox.Parent = SearchContainer

local CenterContainer = Instance.new("Frame"); CenterContainer.Name = "CenterContainer"; CenterContainer.Size = UDim2.new(1, 0, 1, -(40 + Config.FooterHeight)); CenterContainer.Position = UDim2.new(0, 0, 0, 40); CenterContainer.BackgroundTransparency = 1; CenterContainer.ZIndex = 3; CenterContainer.Parent = MainFrame

-- SIDEBAR (Transparent for Anime BG)
local Sidebar = Instance.new("Frame"); Sidebar.Name = "Sidebar"; Sidebar.Size = UDim2.new(0, Config.SidebarWidth, 1, 0); Sidebar.BackgroundColor3 = Color3.new(0,0,0); Sidebar.BackgroundTransparency = 0.6; Sidebar.BorderSizePixel = 0; Sidebar.ZIndex = 3; Sidebar.Parent = CenterContainer

local SidebarList = Instance.new("UIListLayout"); SidebarList.Padding = Config.ListPadding; SidebarList.SortOrder = Enum.SortOrder.LayoutOrder; SidebarList.Parent = Sidebar
local SidebarPadding = Instance.new("UIPadding"); SidebarPadding.PaddingTop = UDim.new(0, 5); SidebarPadding.Parent = Sidebar

-- CONTENT AREA (Transparent for Anime BG)
local ContentArea = Instance.new("Frame"); ContentArea.Name = "ContentArea"; ContentArea.Size = UDim2.new(1, -Config.SidebarWidth, 1, 0); ContentArea.Position = UDim2.new(0, Config.SidebarWidth, 0, 0); ContentArea.BackgroundColor3 = Color3.new(0,0,0); ContentArea.BackgroundTransparency = 0.7; ContentArea.BorderSizePixel = 0; ContentArea.ZIndex = 3; ContentArea.Parent = CenterContainer

local BottomBar = Instance.new("Frame"); BottomBar.Size = UDim2.new(1, 0, 0, Config.FooterHeight); BottomBar.Position = UDim2.new(0, 0, 1, -Config.FooterHeight); BottomBar.BackgroundColor3 = Color3.new(0,0,0); BottomBar.BackgroundTransparency = 0.5; BottomBar.BorderSizePixel = 0; BottomBar.ZIndex = 5; BottomBar.Parent = MainFrame
local StatusText = Instance.new("TextLabel"); StatusText.RichText = true; local modeText = isMobile and "Mobile" or "PC"; 
StatusText.Text = "NexVoid <font color='rgb(220,0,0)'>" .. modeText .. "</font> | Created By DraxynSoulx"; 
StatusText.Size = UDim2.new(1, -5, 1, 0); StatusText.BackgroundTransparency = 1; StatusText.TextColor3 = Theme.Text; StatusText.Font = Theme.Font; StatusText.TextSize = 10; StatusText.TextXAlignment = Enum.TextXAlignment.Right; StatusText.ZIndex = 6; StatusText.Parent = BottomBar

-- Modals
local ModalOverlay = Instance.new("Frame"); ModalOverlay.Size = UDim2.new(1, 0, 1, 0); ModalOverlay.BackgroundColor3 = Color3.new(0,0,0); ModalOverlay.BackgroundTransparency = 0.5; ModalOverlay.Visible = false; ModalOverlay.ZIndex = 10; ModalOverlay.Parent = MainFrame
local function createModalBox(height) local Box = Instance.new("Frame"); Box.Size = UDim2.new(0, 280, 0, height); Box.AnchorPoint = Vector2.new(0.5, 0.5); Box.Position = UDim2.new(0.5, 0, 0.5, 0); Box.BackgroundColor3 = Theme.FrameColor; Box.BorderSizePixel = 0; Box.ZIndex = 11; Box.Visible = false; Box.Parent = ModalOverlay; local TopLine = Instance.new("Frame"); TopLine.Size = UDim2.new(1, 0, 0, 2); TopLine.BackgroundColor3 = Theme.Accent; TopLine.BorderSizePixel = 0; TopLine.ZIndex = 12; TopLine.Parent = Box; return Box end
local ExitBox = createModalBox(120); local YesBtn = Instance.new("TextButton"); YesBtn.Parent = ExitBox; YesBtn.Size = UDim2.new(0, 90, 0, 30); YesBtn.Position = UDim2.new(0, 20, 0, 75); YesBtn.Text = "Exit"; YesBtn.BackgroundColor3 = Theme.CloseRed; YesBtn.TextColor3 = Color3.new(1,1,1); Instance.new("UICorner", YesBtn).CornerRadius = UDim.new(0, 4)
local NoBtn = Instance.new("TextButton"); NoBtn.Parent = ExitBox; NoBtn.Size = UDim2.new(0, 90, 0, 30); NoBtn.Position = UDim2.new(1, -110, 0, 75); NoBtn.Text = "Cancel"; NoBtn.BackgroundColor3 = Theme.ContentColor; NoBtn.TextColor3 = Theme.TextDark; Instance.new("UICorner", NoBtn).CornerRadius = UDim.new(0, 4)
local ExitTitle = Instance.new("TextLabel"); ExitTitle.Parent = ExitBox; ExitTitle.Text = "CONFIRMATION"; ExitTitle.Font = Theme.Font; ExitTitle.TextSize = 14; ExitTitle.TextColor3 = Theme.Accent; ExitTitle.Size = UDim2.new(1, 0, 0, 35); ExitTitle.BackgroundTransparency = 1
local ExitDesc = Instance.new("TextLabel"); ExitDesc.Parent = ExitBox; ExitDesc.Text = "Exit the Script?"; ExitDesc.Font = Enum.Font.Gotham; ExitDesc.TextSize = 14; ExitDesc.TextColor3 = Theme.Text; ExitDesc.Size = UDim2.new(1, 0, 0, 30); ExitDesc.Position = UDim2.new(0, 0, 0, 35); ExitDesc.BackgroundTransparency = 1

-- Settings Modal
local SettingsBox = createModalBox(220)
local SetTitle = Instance.new("TextLabel"); SetTitle.Parent = SettingsBox; SetTitle.Text = "SETTINGS"; SetTitle.Size = UDim2.new(1,0,0,35); SetTitle.TextColor3 = Theme.Accent; SetTitle.BackgroundTransparency = 1; SetTitle.Font = Theme.Font; SetTitle.TextSize = 14

local GameNameLbl = Instance.new("TextLabel")
GameNameLbl.Text = "Game Name: Flee the Facility"
GameNameLbl.Size = UDim2.new(1, -20, 0, 20)
GameNameLbl.Position = UDim2.new(0, 15, 0, 40)
GameNameLbl.BackgroundTransparency = 1
GameNameLbl.TextColor3 = Theme.Text
GameNameLbl.Font = Enum.Font.Gotham
GameNameLbl.TextSize = 12
GameNameLbl.TextXAlignment = Enum.TextXAlignment.Left
GameNameLbl.Parent = SettingsBox

local ExecLbl = Instance.new("TextLabel")
ExecLbl.Text = "Executor: " .. ExecutorName
ExecLbl.Size = UDim2.new(1, -20, 0, 20)
ExecLbl.Position = UDim2.new(0, 15, 0, 60)
ExecLbl.BackgroundTransparency = 1
ExecLbl.TextColor3 = Theme.Text
ExecLbl.Font = Enum.Font.Gotham
ExecLbl.TextSize = 12
ExecLbl.TextXAlignment = Enum.TextXAlignment.Left
ExecLbl.Parent = SettingsBox

local CreatorLbl = Instance.new("TextLabel")
CreatorLbl.Text = "Creator Name: DraxynSoulx"
CreatorLbl.Size = UDim2.new(1, -20, 0, 20)
CreatorLbl.Position = UDim2.new(0, 15, 0, 80)
CreatorLbl.BackgroundTransparency = 1
CreatorLbl.TextColor3 = Theme.Accent -- Highlight
CreatorLbl.Font = Enum.Font.GothamBold
CreatorLbl.TextSize = 12
CreatorLbl.TextXAlignment = Enum.TextXAlignment.Left
CreatorLbl.Parent = SettingsBox

local KeyLabel = Instance.new("TextLabel"); KeyLabel.Text = "Menu Key:"; KeyLabel.Font = Enum.Font.Gotham; KeyLabel.TextSize = 12; KeyLabel.TextColor3 = Theme.Text; KeyLabel.Size = UDim2.new(0, 100, 0, 30); KeyLabel.Position = UDim2.new(0, 15, 0, 120); KeyLabel.BackgroundTransparency = 1; KeyLabel.TextXAlignment = Enum.TextXAlignment.Left; KeyLabel.ZIndex = 12; KeyLabel.Parent = SettingsBox
local KeyBtn = Instance.new("TextButton"); KeyBtn.Parent = SettingsBox; KeyBtn.Text = CurrentKey.Name; KeyBtn.Size = UDim2.new(0, 80, 0, 26); KeyBtn.Position = UDim2.new(1, -100, 0, 122); KeyBtn.BackgroundColor3 = Theme.ContentColor; KeyBtn.TextColor3 = Theme.Accent; Instance.new("UICorner", KeyBtn).CornerRadius = UDim.new(0, 4)

local CloseSetBtn = Instance.new("TextButton"); CloseSetBtn.Parent = SettingsBox; CloseSetBtn.Text = "Close"; CloseSetBtn.Size = UDim2.new(0, 240, 0, 30); CloseSetBtn.Position = UDim2.new(0, 20, 1, -40); CloseSetBtn.BackgroundColor3 = Theme.ContentColor; CloseSetBtn.TextColor3 = Theme.TextDark; Instance.new("UICorner", CloseSetBtn).CornerRadius = UDim.new(0, 4)

CloseBtn.MouseButton1Click:Connect(function() ModalOverlay.Visible = true; ExitBox.Visible = true; SettingsBox.Visible = false end)
SettingsBtn.MouseButton1Click:Connect(function() ModalOverlay.Visible = true; SettingsBox.Visible = true; ExitBox.Visible = false end)
CloseSetBtn.MouseButton1Click:Connect(function() ModalOverlay.Visible = false; SettingsBox.Visible = false end)
NoBtn.MouseButton1Click:Connect(function() ModalOverlay.Visible = false; ExitBox.Visible = false end)
YesBtn.MouseButton1Click:Connect(function() ScreenGui:Destroy() end)
KeyBtn.MouseButton1Click:Connect(function() KeyBtn.Text = "..."; local input = UserInputService.InputBegan:Wait(); if input.KeyCode ~= Enum.KeyCode.Unknown then CurrentKey = input.KeyCode; KeyBtn.Text = CurrentKey.Name end end)

local isSearching = false
SearchBtn.MouseButton1Click:Connect(function()
	isSearching = not isSearching
	if isSearching then SearchContainer:TweenSize(UDim2.new(0, 150, 0, 26), "Out", "Quad", 0.3, true); task.wait(0.1); SearchBox:CaptureFocus() 
	else SearchContainer:TweenSize(UDim2.new(0, 0, 0, 26), "Out", "Quad", 0.3, true); SearchBox:ReleaseFocus(); SearchBox.Text = ""
		for _, p in pairs(ContentArea:GetChildren()) do if p:IsA("ScrollingFrame") then for _, i in pairs(p:GetDescendants()) do if i:IsA("GuiObject") then i.Visible = true end end end end
	end
end)
SearchBox:GetPropertyChangedSignal("Text"):Connect(function()
	local text = SearchBox.Text:lower()
	for _, page in pairs(ContentArea:GetChildren()) do if page:IsA("ScrollingFrame") then
		for _, item in pairs(page:GetChildren()) do
			if item:IsA("Frame") or item:IsA("TextButton") then
				local lbl = item:FindFirstChildWhichIsA("TextLabel") or (item:IsA("TextButton") and item) or nil
				local txt = (lbl and lbl.Text or ""):lower()
				if txt:find(text) then item.Visible = true else if text ~= "" then item.Visible = false end end
			end
		end
	end end
end)

-- TOGGLE LOGIC
UserInputService.InputBegan:Connect(function(input, gp)
	if not gp and input.KeyCode == CurrentKey then
		MainFrame.Visible = not MainFrame.Visible
		OpenButton.Visible = false 
	end
end)

MinimizeBtn.MouseButton1Click:Connect(function() MainFrame.Visible = false; OpenButton.Visible = true end)
OpenButton.MouseButton1Click:Connect(function() MainFrame.Visible = true; OpenButton.Visible = false end)

-- LIBRARY
local Library = {}
local tabs = {}

function createSidebarButton(iconId, name)
	local Page = Instance.new("ScrollingFrame"); Page.Name = name .. "Page"
	Page.Size = UDim2.new(1, -20, 1, -10); Page.Position = UDim2.new(0, 10, 0, 5)
	Page.BackgroundTransparency = 1; Page.BorderSizePixel = 0
	Page.ScrollBarThickness = 2; Page.ScrollBarImageColor3 = Theme.Accent
	Page.ScrollBarImageTransparency = 0 
	Page.CanvasSize = UDim2.new(0, 0, 0, 0); Page.AutomaticCanvasSize = Enum.AutomaticSize.Y; Page.ScrollingDirection = Enum.ScrollingDirection.Y
	Page.Visible = false; Page.Parent = ContentArea
	local PL = Instance.new("UIListLayout"); PL.Padding = ContentConfig.ItemPadding; PL.SortOrder = Enum.SortOrder.LayoutOrder; PL.Parent = Page
	local PP = Instance.new("UIPadding"); PP.PaddingBottom = UDim.new(0, 10); PP.Parent = Page
	local TabButton = Instance.new("TextButton"); TabButton.Size = UDim2.new(1, 0, 0, Config.BtnHeight); TabButton.BackgroundTransparency = 1; TabButton.Text = ""; TabButton.Parent = Sidebar
	local Indicator = Instance.new("Frame"); Indicator.Size = UDim2.new(0, 3, 0.7, 0); Indicator.Position = UDim2.new(0, 0, 0.15, 0); Indicator.BackgroundColor3 = Theme.Accent; Indicator.BackgroundTransparency = 1; Indicator.BorderSizePixel = 0; Indicator.Parent = TabButton
	local Icon = Instance.new("ImageLabel"); Icon.Image = "rbxassetid://" .. iconId; Icon.Size = UDim2.new(0, Config.IconSize, 0, Config.IconSize); Icon.Position = UDim2.new(0, 12, 0.5, -(Config.IconSize/2)); Icon.BackgroundTransparency = 1; Icon.ScaleType = Enum.ScaleType.Fit; Icon.ImageColor3 = Theme.TextDark; Icon.Parent = TabButton
	local Label = Instance.new("TextLabel"); Label.Text = name; Label.Size = UDim2.new(0, 100, 1, 0); Label.Position = UDim2.new(0, 38, 0, 0); Label.BackgroundTransparency = 1; Label.Font = Theme.Font; Label.TextSize = Config.FontSize; Label.TextColor3 = Theme.TextDark; Label.TextXAlignment = Enum.TextXAlignment.Left; Label.Parent = TabButton
	TabButton.MouseButton1Click:Connect(function()
		for _, tab in pairs(tabs) do tab.Page.Visible = false; tab.Indicator.BackgroundTransparency = 1; tab.Label.TextColor3 = Theme.TextDark; tab.Icon.ImageColor3 = Theme.TextDark end
		Page.Visible = true; Indicator.BackgroundTransparency = 0; Label.TextColor3 = Theme.Accent; Icon.ImageColor3 = Theme.Accent
	end)
	table.insert(tabs, {Page = Page, Indicator = Indicator, Label = Label, Icon = Icon})
	return Page
end

function Library:CreateButton(Page, Text, Callback)
	local BtnFrame = Instance.new("TextButton"); 
	BtnFrame.Size = UDim2.new(1, 0, 0, ContentConfig.ItemHeight); 
	BtnFrame.BackgroundColor3 = Theme.ItemColor; 
	BtnFrame.BackgroundTransparency = 0.4; 
	BtnFrame.Text = ""; 
	BtnFrame.Parent = Page; 
	Instance.new("UICorner", BtnFrame).CornerRadius = UDim.new(0, 6)
	local Label = Instance.new("TextLabel"); Label.Size = UDim2.new(1, -20, 1, 0); Label.Position = UDim2.new(0, 10, 0, 0); Label.BackgroundTransparency = 1; Label.Text = Text; Label.TextColor3 = Theme.Text; Label.Font = Theme.Font; Label.TextSize = 12; Label.TextXAlignment = Enum.TextXAlignment.Left; Label.Parent = BtnFrame
	BtnFrame.MouseButton1Click:Connect(function() pcall(Callback) end)
end

function Library:CreateToggle(Page, Text, Default, Callback)
	local Tgl = Instance.new("TextButton"); 
	Tgl.Size = UDim2.new(1, 0, 0, ContentConfig.ItemHeight); 
	Tgl.BackgroundColor3 = Theme.ItemColor; 
	Tgl.BackgroundTransparency = 0.4; 
	Tgl.Text = ""; 
	Tgl.Parent = Page; 
	Instance.new("UICorner", Tgl).CornerRadius = UDim.new(0, 6)
	local Label = Instance.new("TextLabel"); Label.Size = UDim2.new(0.7, 0, 1, 0); Label.Position = UDim2.new(0, 12, 0, 0); Label.BackgroundTransparency = 1; Label.Text = Text; Label.TextColor3 = Theme.Text; Label.Font = Theme.Font; Label.TextSize = 12; Label.TextXAlignment = Enum.TextXAlignment.Left; Label.Parent = Tgl
	local Bg = Instance.new("Frame"); Bg.Size = UDim2.new(0, 34, 0, 18); Bg.Position = UDim2.new(1, -46, 0.5, -9); Bg.BackgroundColor3 = Theme.SwitchOff; Bg.Parent = Tgl; Instance.new("UICorner", Bg).CornerRadius = UDim.new(1, 0)
	local Cir = Instance.new("Frame"); Cir.Size = UDim2.new(0, 14, 0, 14); Cir.Position = UDim2.new(0, 2, 0.5, -7); Cir.BackgroundColor3 = Color3.fromRGB(150, 150, 150); Cir.Parent = Bg; Instance.new("UICorner", Cir).CornerRadius = UDim.new(1, 0)
	local State = Default or false
	local function Upd()
		if State then TweenService:Create(Bg, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Accent}):Play(); TweenService:Create(Cir, TweenInfo.new(0.2), {Position = UDim2.new(1, -16, 0.5, -7), BackgroundColor3 = Color3.new(1,1,1)}):Play()
		else TweenService:Create(Bg, TweenInfo.new(0.2), {BackgroundColor3 = Theme.SwitchOff}):Play(); TweenService:Create(Cir, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -7), BackgroundColor3 = Color3.fromRGB(150, 150, 150)}):Play() end
		pcall(Callback, State)
	end
	
	local function Set(val)
		State = val
		if State then TweenService:Create(Bg, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Accent}):Play(); TweenService:Create(Cir, TweenInfo.new(0.2), {Position = UDim2.new(1, -16, 0.5, -7), BackgroundColor3 = Color3.new(1,1,1)}):Play()
		else TweenService:Create(Bg, TweenInfo.new(0.2), {BackgroundColor3 = Theme.SwitchOff}):Play(); TweenService:Create(Cir, TweenInfo.new(0.2), {Position = UDim2.new(0, 2, 0.5, -7), BackgroundColor3 = Color3.fromRGB(150, 150, 150)}):Play() end
	end
	
	Tgl.MouseButton1Click:Connect(function() State = not State; Upd() end); if Default then Upd() end
	return {Set = Set}
end

function Library:CreateSection(Page, Text)
	local Section = Instance.new("Frame"); Section.Size = UDim2.new(1, 0, 0, 20); Section.BackgroundTransparency = 1; Section.Parent = Page
	local Label = Instance.new("TextLabel"); Label.Size = UDim2.new(1, 0, 1, 0); Label.BackgroundTransparency = 1; Label.Text = Text; Label.Font = Enum.Font.GothamBold; Label.TextSize = 11; Label.TextColor3 = Theme.Accent; Label.TextXAlignment = Enum.TextXAlignment.Left; Label.Parent = Section
	local Line = Instance.new("Frame"); Line.Size = UDim2.new(1, -(Label.TextBounds.X + 10), 0, 1); Line.Position = UDim2.new(0, Label.TextBounds.X + 10, 0.5, 0); Line.BackgroundColor3 = Theme.ItemStroke; Line.BorderSizePixel = 0; Line.Parent = Section
end

function Library:CreateSlider(Page, Text, Min, Max, Default, Callback)
	local Frame = Instance.new("Frame"); 
	Frame.Size = UDim2.new(1, 0, 0, 40); 
	Frame.BackgroundColor3 = Theme.ItemColor; 
	Frame.BackgroundTransparency = 0.4;
	Frame.Parent = Page; 
	Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
	local Label = Instance.new("TextLabel"); Label.Size = UDim2.new(1, -20, 0, 20); Label.Position = UDim2.new(0, 10, 0, 2); Label.BackgroundTransparency = 1; Label.Text = Text; Label.TextColor3 = Theme.Text; Label.Font = Theme.Font; Label.TextSize = 11; Label.TextXAlignment = Enum.TextXAlignment.Left; Label.Parent = Frame
	local ValueLabel = Instance.new("TextLabel"); ValueLabel.Size = UDim2.new(0, 40, 0, 20); ValueLabel.Position = UDim2.new(1, -10, 0, 2); ValueLabel.AnchorPoint = Vector2.new(1, 0); ValueLabel.BackgroundTransparency = 1; ValueLabel.Text = tostring(Default); ValueLabel.TextColor3 = Theme.TextDark; ValueLabel.Font = Theme.Font; ValueLabel.TextSize = 11; ValueLabel.TextXAlignment = Enum.TextXAlignment.Right; ValueLabel.Parent = Frame
	local SliderBar = Instance.new("Frame"); SliderBar.Size = UDim2.new(1, -20, 0, 4); SliderBar.Position = UDim2.new(0, 10, 0, 28); SliderBar.BackgroundColor3 = Theme.SwitchOff; SliderBar.BorderSizePixel = 0; SliderBar.Parent = Frame; Instance.new("UICorner", SliderBar).CornerRadius = UDim.new(1, 0)
	local Fill = Instance.new("Frame"); Fill.Size = UDim2.new((Default - Min) / (Max - Min), 0, 1, 0); Fill.BackgroundColor3 = Theme.Accent; Fill.BorderSizePixel = 0; Fill.Parent = SliderBar; Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)
	local Trigger = Instance.new("TextButton"); Trigger.Size = UDim2.new(1, 0, 1, 0); Trigger.BackgroundTransparency = 1; Trigger.Text = ""; Trigger.Parent = SliderBar
	local dragging = false
	local function Update(input)
		local pos = UDim2.new(math.clamp((input.Position.X - SliderBar.AbsolutePosition.X) / SliderBar.AbsoluteSize.X, 0, 1), 0, 1, 0)
		Fill.Size = pos
		local value = math.floor(Min + ((Max - Min) * pos.X.Scale))
		ValueLabel.Text = tostring(value)
		pcall(Callback, value)
	end
	Trigger.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = true; Update(input) end end)
	UserInputService.InputEnded:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = false end end)
	UserInputService.InputChanged:Connect(function(input) if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then Update(input) end end)
end

-- NEW GENERIC INPUT BOX
function Library:CreateInput(Page, Text, Default, Callback)
	local Container = Instance.new("Frame"); 
	Container.Size = UDim2.new(1, 0, 0, 40); 
	Container.BackgroundColor3 = Theme.ItemColor; 
	Container.BackgroundTransparency = 0.4;
	Container.Parent = Page; 
	Instance.new("UICorner", Container).CornerRadius = UDim.new(0, 6)
	local Label = Instance.new("TextLabel"); Label.Size = UDim2.new(1, -90, 1, 0); Label.Position = UDim2.new(0, 10, 0, 0); Label.BackgroundTransparency = 1; Label.Text = Text; Label.TextColor3 = Theme.Text; Label.Font = Theme.Font; Label.TextSize = 12; Label.TextXAlignment = Enum.TextXAlignment.Left; Label.Parent = Container
	
	local Box = Instance.new("TextBox"); Box.Size = UDim2.new(0, 70, 0, 26); Box.Position = UDim2.new(1, -80, 0.5, -13); Box.BackgroundColor3 = Theme.SwitchOff; Box.Text = tostring(Default); Box.TextColor3 = Theme.Text; Box.Font = Theme.Font; Box.TextSize = 11; Box.Parent = Container; Instance.new("UICorner", Box).CornerRadius = UDim.new(0, 4)
	
	Box.FocusLost:Connect(function()
		local num = tonumber(Box.Text)
		if num then
			pcall(Callback, num)
		else
			Box.Text = tostring(Default) -- Reset on invalid input
		end
	end)
end

function Library:CreateCustomIDInput(Page, IsMobile)
	local Container = Instance.new("Frame"); 
	Container.Size = UDim2.new(1, 0, 0, 40); 
	Container.BackgroundColor3 = Theme.ItemColor; 
	Container.BackgroundTransparency = 0.4;
	Container.Parent = Page; 
	Instance.new("UICorner", Container).CornerRadius = UDim.new(0, 6)
	local TextBox = Instance.new("TextBox"); TextBox.Size = UDim2.new(1, -70, 1, 0); TextBox.Position = UDim2.new(0, 10, 0, 0); TextBox.BackgroundTransparency = 1; TextBox.Text = ""; TextBox.PlaceholderText = "Enter Texture ID..."; TextBox.TextColor3 = Theme.Text; TextBox.PlaceholderColor3 = Theme.TextDark; TextBox.Font = Theme.Font; TextBox.TextSize = 12; TextBox.TextXAlignment = Enum.TextXAlignment.Left; TextBox.Parent = Container
	local ApplyBtn = Instance.new("TextButton"); ApplyBtn.Size = UDim2.new(0, 50, 0, 26); ApplyBtn.Position = UDim2.new(1, -60, 0.5, -13); ApplyBtn.BackgroundColor3 = Theme.Accent; ApplyBtn.Text = "Apply"; ApplyBtn.TextColor3 = Color3.new(1,1,1); ApplyBtn.Font = Theme.Font; ApplyBtn.TextSize = 11; ApplyBtn.Parent = Container; Instance.new("UICorner", ApplyBtn).CornerRadius = UDim.new(0, 4)
	ApplyBtn.MouseButton1Click:Connect(function()
		local id = TextBox.Text
		if id ~= "" then
			local fullID = "rbxassetid://" .. id:gsub("rbxassetid://", "")
			if IsMobile then MobileCrosshair.Image = fullID; MobileCrosshair.Visible = true
			else PCSoftwareCursor.Image = fullID; PCCursorActive = true; PCSoftwareCursor.Visible = true end
		end
	end)
end

function Library:CreateCursorGrid(Page, Items, IsMobile)
	local GridContainer = Instance.new("Frame"); GridContainer.Size = UDim2.new(1, 0, 0, 0); GridContainer.BackgroundTransparency = 1; GridContainer.Parent = Page
	local Grid = Instance.new("UIGridLayout"); Grid.CellSize = UDim2.new(0, 50, 0, 50); Grid.CellPadding = UDim2.new(0, 5, 0, 5); Grid.SortOrder = Enum.SortOrder.LayoutOrder; Grid.Parent = GridContainer
	Grid:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function() GridContainer.Size = UDim2.new(1, 0, 0, Grid.AbsoluteContentSize.Y) end)
	for _, item in pairs(Items) do
		local Btn = Instance.new("TextButton"); 
		Btn.BackgroundColor3 = Theme.ItemColor; 
		Btn.BackgroundTransparency = 0.4;
		Btn.Text = ""; 
		Btn.Parent = GridContainer; 
		Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
		
		if item.ID == "RESET" then
			local TextLbl = Instance.new("TextLabel"); TextLbl.Size = UDim2.new(1, 0, 1, 0); TextLbl.BackgroundTransparency = 1; TextLbl.Text = "Default"; TextLbl.TextColor3 = Theme.Accent; TextLbl.Font = Theme.Font; TextLbl.TextSize = 11; TextLbl.Parent = Btn
		else
			local Preview = Instance.new("ImageLabel"); Preview.Size = UDim2.new(0, 24, 0, 24); Preview.Position = UDim2.new(0.5, -12, 0.5, -12); Preview.BackgroundTransparency = 1; Preview.Image = "rbxassetid://" .. item.ID; Preview.ScaleType = Enum.ScaleType.Fit; Preview.Parent = Btn
		end

		Btn.MouseButton1Click:Connect(function()
			if item.ID == "RESET" then
				if IsMobile then MobileCrosshair.Visible = false else PCCursorActive = false; PCSoftwareCursor.Visible = false; UserInputService.MouseIconEnabled = true end
			else
				local fullID = "rbxassetid://" .. item.ID
				if IsMobile then MobileCrosshair.Image = fullID; MobileCrosshair.Visible = true else PCSoftwareCursor.Image = fullID; PCCursorActive = true; PCSoftwareCursor.Visible = true end
			end
		end)
	end
end

function Library:CreatePlayerCard(Page, Player, Callback)
	local Card = Instance.new("Frame"); 
	Card.Size = UDim2.new(1, 0, 0, ContentConfig.PlayerCardHeight); 
	Card.BackgroundColor3 = Theme.ItemColor; 
	Card.BackgroundTransparency = 0.4;
	Card.Parent = Page; 
	Instance.new("UICorner", Card).CornerRadius = UDim.new(0, 6)
	local Avatar = Instance.new("ImageLabel"); Avatar.Size = UDim2.new(0, 36, 0, 36); Avatar.Position = UDim2.new(0, 8, 0.5, -18); Avatar.BackgroundColor3 = Theme.SwitchOff; Avatar.Parent = Card; Instance.new("UICorner", Avatar).CornerRadius = UDim.new(0, 6)
	task.spawn(function() local content, isReady = Players:GetUserThumbnailAsync(Player.UserId, Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48); if isReady then Avatar.Image = content end end)
	local Display = Instance.new("TextLabel"); Display.Text = Player.DisplayName; Display.Size = UDim2.new(1, -130, 0, 18); Display.Position = UDim2.new(0, 54, 0, 8); Display.BackgroundTransparency = 1; Display.Font = Theme.Font; Display.TextSize = 13; Display.TextColor3 = Theme.Text; Display.TextXAlignment = Enum.TextXAlignment.Left; Display.Parent = Card
	local User = Instance.new("TextLabel"); User.Text = "@" .. Player.Name; User.Size = UDim2.new(1, -130, 0, 14); User.Position = UDim2.new(0, 54, 0, 26); User.BackgroundTransparency = 1; User.Font = Enum.Font.Gotham; User.TextSize = 11; User.TextColor3 = Theme.TextDark; User.TextXAlignment = Enum.TextXAlignment.Left; User.Parent = Card
	local ActionBtn = Instance.new("TextButton"); ActionBtn.Size = UDim2.new(0, 75, 0, 26); ActionBtn.Position = UDim2.new(1, -83, 0.5, -13); ActionBtn.BackgroundColor3 = Theme.Accent; ActionBtn.Text = "Teleport"; ActionBtn.Font = Enum.Font.GothamBold; ActionBtn.TextSize = 11; ActionBtn.TextColor3 = Color3.new(1,1,1); ActionBtn.Parent = Card; Instance.new("UICorner", ActionBtn).CornerRadius = UDim.new(0, 6)
	ActionBtn.MouseButton1Click:Connect(function() TweenService:Create(ActionBtn, TweenInfo.new(0.1), {BackgroundColor3 = Color3.fromRGB(0, 150, 200)}):Play(); task.wait(0.1); TweenService:Create(ActionBtn, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Accent}):Play(); pcall(Callback) end)
end

-- ===========================
-- CONTENT GENERATION
-- ===========================

local VisualPage = createSidebarButton("76176408662599", "Visual")
local ProgressPage = createSidebarButton("105442920358687", "Progress")
local VisualSkinsPage = createSidebarButton("13285615740", "Visual Skins") 
local LegitPage = createSidebarButton("11322093465", "Legit")
local TeleportPage = createSidebarButton("12689978575", "Teleport")
local CrossHairPage = createSidebarButton("114326908103962", "CrossHair")
local SoundsPage = createSidebarButton("7203392850", "Sounds")
local SettingsPage = createSidebarButton("18692715829", "Settings")

-- Settings (UPDATED)
do
	-- HITBOX EXTENDER
	Library:CreateSection(SettingsPage, "Hitbox Extender")
	local hbEnabled = false
	local hbShowVisual = true -- Default Show
	local hbSize = 2
	local hbConnection = nil

	local function updateHitboxes()
		for _, v in pairs(Players:GetPlayers()) do
			if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
				local hrp = v.Character.HumanoidRootPart
				
				-- Define tamanho
				local targetSize = Vector3.new(hbSize, hbSize, hbSize)
				if hrp.Size ~= targetSize then hrp.Size = targetSize end
				
				-- Define visual
				local targetTrans = hbShowVisual and 0.6 or 1
				if hrp.Transparency ~= targetTrans then hrp.Transparency = targetTrans end
				
				-- Define colis√£o
				hrp.CanCollide = false
			end
		end
	end

	Library:CreateToggle(SettingsPage, "Enable Hitbox", false, function(state)
		hbEnabled = state
		if state then
			hbConnection = RunService.RenderStepped:Connect(updateHitboxes)
		else
			if hbConnection then hbConnection:Disconnect() end
			for _, v in pairs(Players:GetPlayers()) do
				if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("HumanoidRootPart") then
					v.Character.HumanoidRootPart.Size = Vector3.new(2, 2, 1)
					v.Character.HumanoidRootPart.Transparency = 1
					v.Character.HumanoidRootPart.CanCollide = true
				end
			end
		end
	end)
	
	Library:CreateToggle(SettingsPage, "Show Hitbox Visual", true, function(state)
		hbShowVisual = state
	end)
	
	-- Changed to INPUT BOX
	Library:CreateInput(SettingsPage, "Hitbox Size", 2, function(val) 
		hbSize = val 
	end)

	-- WALKSPEED
	Library:CreateSection(SettingsPage, "WalkSpeed")
	local wsEnabled = false
	local wsValue = 16
	local wsConnection = nil

	Library:CreateToggle(SettingsPage, "Enable WalkSpeed", false, function(state)
		wsEnabled = state
		if state then
			wsConnection = RunService.Stepped:Connect(function()
				if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
					LocalPlayer.Character.Humanoid.WalkSpeed = wsValue
				end
			end)
		else
			if wsConnection then wsConnection:Disconnect() end
			if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
				LocalPlayer.Character.Humanoid.WalkSpeed = 16
			end
		end
	end)
	
	-- Changed to INPUT BOX
	Library:CreateInput(SettingsPage, "Speed Value", 16, function(val) 
		wsValue = val 
	end)

	-- COLOR PICKERS REMOVED AS REQUESTED
end

-- ===========================
-- LEGIT INTEGRATION
-- ===========================
do
	-- Variables for managing state
	local stretchConnection = nil
	local greyConnection = nil
	local hackConnection = nil
	local mapTextureConnection = nil
	
	local fogRestore = {Color = nil, Glare = nil, Haze = nil, Decay = nil, Density = nil, Offset = nil}
	
	-- 1. GRAY CHARACTERS (BUG FIX: RESTORES CLOTHES NOW)
	local OriginalCharacterData = {}

	local function SaveCharData(player)
		if not player.Character then return end
		if OriginalCharacterData[player] then return end -- Don't overwrite if active

		local data = {
			Parts = {},
			Clothes = {}
		}

		for _, v in ipairs(player.Character:GetChildren()) do
			if v:IsA("BasePart") then
				data.Parts[v] = {Color = v.Color, Material = v.Material}
			elseif v:IsA("Clothing") or v:IsA("ShirtGraphic") then
				table.insert(data.Clothes, v)
			elseif v:IsA("Accessory") and v:FindFirstChild("Handle") then
				local h = v.Handle
				if h:IsA("BasePart") then
					data.Parts[h] = {Color = h.Color, Material = h.Material}
				end
			end
		end
		OriginalCharacterData[player] = data
	end

	local function ApplyGray(player)
		if not player.Character then return end
		SaveCharData(player) -- Save before apply

		local char = player.Character
		-- 1. Apply Gray to Parts
		for _, v in ipairs(char:GetChildren()) do
			if v:IsA("BasePart") then
				v.Color = Color3.fromRGB(150, 150, 150)
				v.Material = Enum.Material.SmoothPlastic
			elseif v:IsA("Accessory") and v:FindFirstChild("Handle") then
				local h = v.Handle
				if h:IsA("BasePart") then
					h.Color = Color3.fromRGB(150, 150, 150)
					h.Material = Enum.Material.SmoothPlastic
				end
			end
		end

		-- 2. Hide Clothes (Unparent to remove from char but keep in memory)
		local data = OriginalCharacterData[player]
		if data and data.Clothes then
			for _, cloth in ipairs(data.Clothes) do
				cloth.Parent = nil
			end
		end
	end

	local function RestoreGray()
		for player, data in pairs(OriginalCharacterData) do
			if player.Character then
				-- Restore Parts Colors
				for part, props in pairs(data.Parts) do
					if part.Parent then
						part.Color = props.Color
						part.Material = props.Material
					end
				end
				-- Restore Clothes
				for _, cloth in ipairs(data.Clothes) do
					cloth.Parent = player.Character
				end
			end
		end
		OriginalCharacterData = {} -- Clear cache
	end

	Library:CreateToggle(LegitPage, "Gray characters", false, function(state)
		if state then
			for _, player in ipairs(Players:GetChildren()) do ApplyGray(player) end
			greyConnection = Players.PlayerAdded:Connect(function(player)
				player.CharacterAdded:Wait()
				ApplyGray(player)
			end)
		else
			if greyConnection then greyConnection:Disconnect(); greyConnection = nil end
			RestoreGray()
		end
	end)

	-- 2. REMOVE TEXTURES
	local OriginalMapData = {}
	
	local function SaveMap()
		if next(OriginalMapData) then return end 
		for _, v in pairs(Workspace:GetDescendants()) do
			if v:IsA("BasePart") and not v:IsA("Terrain") then
				OriginalMapData[v] = {Mat = v.Material}
			elseif v:IsA("Texture") or v:IsA("Decal") then
				OriginalMapData[v] = {Trans = v.Transparency}
			end
		end
	end

	local function ApplyNoTextures()
		SaveMap() 
		for _, v in pairs(Workspace:GetDescendants()) do
			if v:IsA("BasePart") and not v:IsA("Terrain") then
				v.Material = Enum.Material.SmoothPlastic
			elseif v:IsA("Texture") or v:IsA("Decal") then
				v.Transparency = 1 
			end
		end
	end

	local function RestoreMap()
		for v, data in pairs(OriginalMapData) do
			if v and v.Parent then
				if v:IsA("BasePart") then
					v.Material = data.Mat
				elseif v:IsA("Texture") or v:IsA("Decal") then
					v.Transparency = data.Trans
				end
			end
		end
		OriginalMapData = {} 
	end

	Library:CreateToggle(LegitPage, "Remove Textures", false, function(state)
		if state then
			ApplyNoTextures()
			mapTextureConnection = Workspace.DescendantAdded:Connect(function(v)
				if v:IsA("BasePart") and not v:IsA("Terrain") then
					v.Material = Enum.Material.SmoothPlastic
				elseif v:IsA("Texture") or v:IsA("Decal") then
					v.Transparency = 1
				end
			end)
		else
			if mapTextureConnection then mapTextureConnection:Disconnect() end
			RestoreMap()
		end
	end)

	-- 3. STRETCH SCREEN
	Library:CreateToggle(LegitPage, "stretch screen", false, function(state)
		if state then
			getgenv().Resolution = {[".gg/scripters"] = 0.65}
			local Camera = workspace.CurrentCamera
			stretchConnection = game:GetService("RunService").RenderStepped:Connect(function()
				Camera.CFrame = Camera.CFrame * CFrame.new(0, 0, 0, 1, 0, 0, 0, getgenv().Resolution[".gg/scripters"], 0, 0, 0, 1)
			end)
		else
			if stretchConnection then stretchConnection:Disconnect(); stretchConnection = nil end
			-- Restore Scale
			local Camera = workspace.CurrentCamera
			getgenv().Resolution = {[".gg/scripters"] = 1} 
		end
	end)

	-- 4. REMOVE YOUR STEPS
	Library:CreateToggle(LegitPage, "Remove Your Steps", false, function(state)
		LegitSettings.MuteSteps = state
		if state then
			if LocalPlayer.Character then ProcessCharacter(LocalPlayer.Character) end
		else
			if LocalPlayer.Character then ProcessCharacter(LocalPlayer.Character) end
		end
	end)

	-- 5. REMOVE YOUR JUMPS
	Library:CreateToggle(LegitPage, "Remove Your Jumps", false, function(state)
		LegitSettings.MuteJumps = state
		if state then
			if LocalPlayer.Character then ProcessCharacter(LocalPlayer.Character) end
		else
			if LocalPlayer.Character then ProcessCharacter(LocalPlayer.Character) end
		end
	end)

	-- 6. REMOVE FOG
	Library:CreateToggle(LegitPage, "Remove Fog", false, function(state)
		local lighting = game:GetService("Lighting")
		local atmosphere = lighting:FindFirstChildOfClass("Atmosphere")
		
		if not atmosphere then return end

		if state then
			fogRestore.Color = atmosphere.Color
			fogRestore.Glare = atmosphere.Glare
			fogRestore.Haze = atmosphere.Haze
			fogRestore.Decay = atmosphere.Decay
			fogRestore.Density = atmosphere.Density
			fogRestore.Offset = atmosphere.Offset
			
			atmosphere.Color = Color3.fromRGB(0, 0, 0)
			atmosphere.Glare = 0
			atmosphere.Haze = 2.46
			atmosphere.Decay = Color3.fromRGB(0, 0, 0)
			atmosphere.Density = 0.75
			atmosphere.Offset = 0
		else
			if fogRestore.Color then
				atmosphere.Color = fogRestore.Color
				atmosphere.Glare = fogRestore.Glare
				atmosphere.Haze = fogRestore.Haze
				atmosphere.Decay = fogRestore.Decay
				atmosphere.Density = fogRestore.Density
				atmosphere.Offset = fogRestore.Offset
			end
		end
	end)

	-- 7. REMOVE PC HACK SOUNDS
	local hackSignals = {}
	local HACK_KEYWORDS = {"keyboard", "typing", "type", "hack", "key"}
	
	local function isHackSound(sound)
		local name = sound.Name:lower()
		for _, keyword in ipairs(HACK_KEYWORDS) do
			if name:find(keyword) then return true end
		end
		return false
	end
	
	local function isFromComputer(sound)
		local parent = sound.Parent
		while parent do
			if parent.Name == "ComputerTable" then return true end
			parent = parent.Parent
		end
		return false
	end
	
	local function muteHack(sound)
		sound.Volume = 0
		local sig = sound:GetPropertyChangedSignal("Volume"):Connect(function()
			sound.Volume = 0
		end)
		table.insert(hackSignals, {Signal = sig, Object = sound})
	end

	Library:CreateToggle(LegitPage, "Remove Pc Hack Sounds", false, function(state)
		if state then
			-- Existing
			for _, obj in ipairs(Workspace:GetDescendants()) do
				if obj:IsA("Sound") and isHackSound(obj) and isFromComputer(obj) then
					muteHack(obj)
				end
			end
			-- New
			hackConnection = Workspace.DescendantAdded:Connect(function(obj)
				if obj:IsA("Sound") then
					if isHackSound(obj) and isFromComputer(obj) then
						muteHack(obj)
					end
				end
			end)
		else
			if hackConnection then hackConnection:Disconnect(); hackConnection = nil end
			for _, data in ipairs(hackSignals) do
				if data.Signal then data.Signal:Disconnect() end
				if data.Object then data.Object.Volume = 0.5 end
			end
			hackSignals = {}
		end
	end)
end

-- Crosshair Data
local CursorList = {
	{Name = "Default", ID = "RESET"},
	{Name = "Use Cursor", ID = "15368174199"}, {Name = "Use Cursor", ID = "12701650945"}, {Name = "Use Cursor", ID = "128514706094926"},
	{Name = "Use Cursor", ID = "119350232226515"}, {Name = "Use Cursor", ID = "5060823578"}, {Name = "Use Cursor", ID = "9896571799"},
	{Name = "Use Cursor", ID = "139654963330788"}, {Name = "Use Cursor", ID = "13441649168"}, {Name = "Use Cursor", ID = "88005681147215"},
	{Name = "Use Cursor", ID = "72902755839437"}, {Name = "Use Cursor", ID = "128926155948846"}, {Name = "Use Cursor", ID = "95348763251820"},
	{Name = "Use Cursor", ID = "138513473967293"}, {Name = "Use Cursor", ID = "82043397777881"}, {Name = "Use Cursor", ID = "84583215296063"},
	{Name = "Use Cursor", ID = "120058675182639"}, {Name = "Use Cursor", ID = "130210380679877"}, {Name = "Use Cursor", ID = "74264514489577"},
	{Name = "Use Cursor", ID = "115877213393063"}, {Name = "Use Cursor", ID = "133579119074302"}, {Name = "Use Cursor", ID = "137970082797101"},
	{Name = "Use Cursor", ID = "116865736993390"}
}

-- Crosshair UI Construction
Library:CreateSection(CrossHairPage, "Settings")
Library:CreateSlider(CrossHairPage, "Cursor Size", 10, 100, 24, UpdateCursorSizes)

Library:CreateSection(CrossHairPage, "Computer Cursor")
Library:CreateCustomIDInput(CrossHairPage, false)
Library:CreateCursorGrid(CrossHairPage, CursorList, false)

Library:CreateSection(CrossHairPage, "Mobile Cursor")
Library:CreateCustomIDInput(CrossHairPage, true)
Library:CreateCursorGrid(CrossHairPage, CursorList, true)

-- SOUNDS SYSTEM UI
local SoundIDs = {
	Facility = {Walk = "131592620665625", Jump = "89459688918065", Fall = "88947883822456"},
	Noob = {Walk = "110709356093026", Jump = "124276657634407", Fall = "88947883822456"},
	Morcego = {Walk = "97458293386939", Jump = "72503238596964", Fall = "83702883984130"},
	FKPS = {Walk = "97733831736820", Jump = "86031664547378", Fall = "78180192109919"},
	Normal = {Walk = "79392671800290", Jump = "80853972291847", Fall = "88947883822456"},
	Others = {Pew = "136299701781122", Sharingan = "118102230060662", Bubble = "129415490412106", Laugh = "80276851298640"}
}

Library:CreateSection(SoundsPage, "General")
Library:CreateButton(SoundsPage, "Default Sounds (Reset)", function()
	SetSound("Running", "Default", 1.0)
	SetSound("Jumping", "Default", 0.5)
	SetSound("Landing", "Default", 0.5)
end)

Library:CreateSection(SoundsPage, "Facility Gamer")
Library:CreateButton(SoundsPage, "FootSteps", function() SetSound("Running", SoundIDs.Facility.Walk, 1.0) end)
Library:CreateButton(SoundsPage, "Jump", function() SetSound("Jumping", SoundIDs.Facility.Jump, 0.2) end)

Library:CreateSection(SoundsPage, "NoobTwoPoint")
Library:CreateButton(SoundsPage, "FootSteps", function() SetSound("Running", SoundIDs.Noob.Walk, 1.0) end)
Library:CreateButton(SoundsPage, "Jump", function() SetSound("Jumping", SoundIDs.Noob.Jump, 0.2) end)

Library:CreateSection(SoundsPage, "Tio Morcego")
Library:CreateButton(SoundsPage, "FootSteps", function() SetSound("Running", SoundIDs.Morcego.Walk, 1.0) end)
Library:CreateButton(SoundsPage, "Jump", function() SetSound("Jumping", SoundIDs.Morcego.Jump, 0.2) end)
Library:CreateButton(SoundsPage, "Fall", function() SetSound("Landing", SoundIDs.Morcego.Fall, 0.5) end)

Library:CreateSection(SoundsPage, "FKPS")
Library:CreateButton(SoundsPage, "FootSteps", function() SetSound("Running", SoundIDs.FKPS.Walk, 1.0) end)
Library:CreateButton(SoundsPage, "Jumps", function() SetSound("Jumping", SoundIDs.FKPS.Jump, 0.2) end)
Library:CreateButton(SoundsPage, "Fall", function() SetSound("Landing", SoundIDs.FKPS.Fall, 0.5) end)

Library:CreateSection(SoundsPage, "Normal")
Library:CreateButton(SoundsPage, "FootSteps", function() SetSound("Running", SoundIDs.Normal.Walk, 1.0) end)
Library:CreateButton(SoundsPage, "Jump", function() SetSound("Jumping", SoundIDs.Normal.Jump, 0.2) end)
Library:CreateButton(SoundsPage, "Fall", function() SetSound("Landing", SoundIDs.Normal.Fall, 0.5) end)

Library:CreateSection(SoundsPage, "Others")
Library:CreateButton(SoundsPage, "Pew Jump", function() SetSound("Jumping", SoundIDs.Others.Pew, 0.2) end)
Library:CreateButton(SoundsPage, "Sharingan Jump", function() SetSound("Jumping", SoundIDs.Others.Sharingan, 0.2) end)
Library:CreateButton(SoundsPage, "Albino Jump", function() SetSound("Jumping", SoundIDs.Others.Bubble, 0.2) end)
Library:CreateButton(SoundsPage, "Anime Laugh", function() SetSound("Jumping", SoundIDs.Others.Laugh, 0.2) end)


-- Teleport
local function UpdateTeleportList()
	for _, child in pairs(TeleportPage:GetChildren()) do if child:IsA("Frame") or child:IsA("TextButton") then child:Destroy() end end
	local RefreshBtn = Instance.new("TextButton"); RefreshBtn.Size = UDim2.new(1, 0, 0, 32); RefreshBtn.BackgroundColor3 = Theme.ItemStroke; RefreshBtn.Text = "Refresh"; RefreshBtn.TextColor3 = Theme.Accent; RefreshBtn.Font = Theme.Font; RefreshBtn.TextSize = 13; RefreshBtn.Parent = TeleportPage; Instance.new("UICorner", RefreshBtn).CornerRadius = UDim.new(0, 6)
	RefreshBtn.MouseButton1Click:Connect(function() UpdateTeleportList() end)
	local Spacer = Instance.new("Frame"); Spacer.Size = UDim2.new(1, 0, 0, 5); Spacer.BackgroundTransparency = 1; Spacer.Parent = TeleportPage
	for _, player in pairs(Players:GetPlayers()) do
		if player ~= LocalPlayer then
			Library:CreatePlayerCard(TeleportPage, player, function()
				if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
					LocalPlayer.Character.HumanoidRootPart.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 2, 0)
				end
			end)
		end
	end
end
UpdateTeleportList()
Players.PlayerAdded:Connect(UpdateTeleportList); Players.PlayerRemoving:Connect(UpdateTeleportList)

if tabs[1] then tabs[1].Page.Visible = true; tabs[1].Indicator.BackgroundTransparency = 0; tabs[1].Label.TextColor3 = Theme.Accent; tabs[1].Icon.ImageColor3 = Theme.Accent end

print("NexVoid Hub: Complete")
